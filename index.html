<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>퀴즈 시스템</title>
<style>
body { font-family: Arial; margin: 20px; }
h1 { margin-bottom: 10px; }
select, button { padding: 8px; margin-right: 10px; }
#questionArea { margin-top: 20px; }
.question-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 5px; cursor: pointer; }
.question-card:hover { background: #f0f0f0; }
#answerBox { 
    margin-top: 20px; 
    padding: 15px; 
    border: 2px solid #444; 
    background: #f8f8ff; 
    border-radius: 6px;
}
.correct { color: green; font-weight: bold; font-size: 18px; }
.wrong { color: red; font-weight: bold; font-size: 18px; }
#nextBtn { margin-top: 10px; padding: 8px 16px; }
</style>
</head>
<body>

<h1>퀴즈 시스템</h1>

<select id="subjectSelect">
    <option value="">과목 선택</option>
</select>

<select id="themeSelect">
    <option value="">테마 선택</option>
</select>

<div id="questionArea"></div>
<button id="nextBtn">다음 문제</button>

<div id="answerBox"></div>

<script>
// ⭐ 너의 GitHub Pages JSON 주소
const jsonURL = "https://kangroo1209-alt.github.io/quizyquiz/output.json";

let quizData = [];
let currentSubject = "";
let currentTheme = "";
let currentQuestion = "";
let currentAnswers = [];   // 다중 정답 목록

fetch(jsonURL)
.then(res => res.json())
.then(data => {
    quizData = data;
    renderSubjects();
});

const subjectSelect = document.getElementById("subjectSelect");
const themeSelect = document.getElementById("themeSelect");
const questionArea = document.getElementById("questionArea");
const answerBox = document.getElementById("answerBox");
const nextBtn = document.getElementById("nextBtn");

function renderSubjects() {
    const subjects = [...new Set(quizData.map(q => q.subject))];
    subjectSelect.innerHTML =
        '<option value="">과목 선택</option>' +
        subjects.map(s => `<option value="${s}">${s}</option>`).join("");
}

subjectSelect.addEventListener("change", () => {
    currentSubject = subjectSelect.value;
    renderThemes();
    questionArea.innerHTML = "";
    answerBox.innerHTML = "";
});

function renderThemes() {
    const themes = [...new Set(
        quizData.filter(q => q.subject === currentSubject).map(q => q.theme)
    )];

    themeSelect.innerHTML =
        '<option value="">테마 선택</option>' +
        themes.map(t => `<option value="${t}">${t}</option>`).join("");
}

themeSelect.addEventListener("change", () => {
    currentTheme = themeSelect.value;
    renderQuestion();
    answerBox.innerHTML = "";
});

// ⭐ 문제 랜덤 생성
function renderQuestion() {
    if(!currentSubject || !currentTheme){
        questionArea.innerHTML = "<p>과목과 테마를 선택하세요.</p>";
        return;
    }

    const filtered = quizData.filter(
        q => q.subject === currentSubject && q.theme === currentTheme
    );

    if(filtered.length === 0){
        questionArea.innerHTML = "<p>문제가 없습니다.</p>";
        return;
    }

    // 1) 랜덤 문제 선택
    const randIndex = Math.floor(Math.random() * filtered.length);
    const qObj = filtered[randIndex];

    currentQuestion = qObj.question;

    // 2) 같은 question을 가진 모든 정답 찾기 → 다중정답 처리
    currentAnswers = filtered
        .filter(q => q.question === currentQuestion)
        .map(q => q.answer)
        .filter((v, i, arr) => arr.indexOf(v) === i); // 중복 제거

    // 대표 정답 1개만 보기 안에 포함
    const mainAnswer = currentAnswers[0];

    // 3) 테마 내 모든 답 중에서 오답 후보 수집
    let allThemeAnswers = filtered.map(q => q.answer);

    //   - 현재 문제의 모든 정답 제거
    allThemeAnswers = allThemeAnswers.filter(a => !currentAnswers.includes(a));

    //   - 중복 제거
    allThemeAnswers = [...new Set(allThemeAnswers)];

    // 4) 오답 4개 랜덤 선택
    let wrongCandidates = [...allThemeAnswers];

    let choices = [mainAnswer];

    while(choices.length < 5 && wrongCandidates.length > 0){
        const idx = Math.floor(Math.random() * wrongCandidates.length);
        choices.push(wrongCandidates[idx]);
        wrongCandidates.splice(idx, 1);
    }

    // 부족하면 자동 오류 방지
    while(choices.length < 5) choices.push("선택지 부족");

    // 5) 보기 섞기
    choices = choices.sort(() => Math.random() - 0.5);

    // 6) 문제 출력
    questionArea.innerHTML = `<div class="question-card"><b>문제:</b> ${currentQuestion}</div>`;
    
    choices.forEach((ans, i) => {
        questionArea.innerHTML += `
            <div class="question-card" onclick="checkAnswer('${ans.replace(/'/g, "\\'")}')">
                ${i+1}. ${ans}
            </div>
        `;
    });

    // 출력 영역 초기화
    answerBox.innerHTML = "";
}

// ⭐ 정답 체크
window.checkAnswer = (selected) => {
    const isCorrect = currentAnswers.includes(selected);

    if(isCorrect){
        answerBox.innerHTML = `
            <p class="correct">정답입니다!</p>
            <p><b>정답 목록:</b></p>
            <ul>${currentAnswers.map(a=>`<li>${a}</li>`).join("")}</ul>
        `;
    } else {
        answerBox.innerHTML = `
            <p class="wrong">오답입니다!</p>
            <p><b>정답 목록:</b></p>
            <ul>${currentAnswers.map(a=>`<li>${a}</li>`).join("")}</ul>
            <p>선택한 답: ${selected}</p>
        `;
    }
};

// 다음 문제 버튼
nextBtn.addEventListener("click", renderQuestion);
</script>
</body>
</html>
